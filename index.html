<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureExam Pro - Advanced Online Examination System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2b6cb0;
            --accent-color: #e53e3e;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --light-color: #f7fafc;
            --dark-color: #2d3748;
            --gradient-primary: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
            --gradient-secondary: linear-gradient(135deg, #2b6cb0, #2c5282);
            --gradient-accent: linear-gradient(135deg, #e53e3e, #c53030);
            --gradient-success: linear-gradient(135deg, #38a169, #2f855a);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--gradient-primary);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: rgba(26, 54, 93, 0.95);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            color: var(--secondary-color);
        }
        
        .logo span {
            color: var(--secondary-color);
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .auth-buttons button {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .auth-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .user-info {
            display: none;
            align-items: center;
            gap: 15px;
            color: white;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--gradient-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .main-content {
            display: flex;
            margin-top: 30px;
            gap: 25px;
        }
        
        .sidebar {
            flex: 1;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .content {
            flex: 3;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .feature-list {
            list-style-type: none;
        }
        
        .feature-list li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .feature-list li i {
            color: var(--success-color);
            font-size: 1.2rem;
        }
        
        .exam-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
            border-left: 4px solid var(--secondary-color);
        }
        
        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .exam-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .exam-details {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .btn {
            display: inline-block;
            background: var(--gradient-secondary);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            margin-top: 10px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn-danger {
            background: var(--gradient-accent);
        }
        
        .btn-success {
            background: var(--gradient-success);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            position: relative;
            animation: modalAppear 0.3s ease-out;
        }
        
        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--accent-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-group input:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.2);
        }
        
        .otp-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }
        
        .otp-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.2rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .otp-input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.2);
            outline: none;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background-color: #fff5f5;
            border-radius: 6px;
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .options {
            margin-top: 15px;
        }
        
        .option {
            margin-bottom: 10px;
            padding: 15px;
            background-color: #f7fafc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }
        
        .option:hover {
            background-color: #edf2f7;
            transform: translateX(5px);
        }
        
        .option.selected {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .security-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f0fff4, #c6f6d5);
            border-radius: 8px;
            border-left: 4px solid var(--success-color);
        }
        
        .security-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--success-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .webcam-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 220px;
            height: 220px;
            border: 3px solid var(--accent-color);
            border-radius: 50%;
            background-color: #1a202c;
            z-index: 999;
            display: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .webcam-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .webcam-status {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(229, 62, 62, 0.8);
            color: white;
            padding: 5px;
            text-align: center;
            font-size: 0.8rem;
            border-radius: 0 0 50% 50%;
        }
        
        .warning-banner {
            background: linear-gradient(135deg, var(--warning-color), #d69e2e);
            color: white;
            padding: 12px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 6px;
            display: none;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .exam-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        
        .progress-bar {
            height: 12px;
            background-color: #e2e8f0;
            border-radius: 6px;
            margin: 25px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--gradient-secondary);
            width: 0%;
            transition: width 0.5s;
            border-radius: 6px;
        }
        
        .question-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .question-nav-btn {
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            border: 2px solid transparent;
        }
        
        .question-nav-btn.answered {
            background-color: var(--success-color);
            color: white;
        }
        
        .question-nav-btn.current {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .security-log {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            padding: 15px;
            background-color: #f7fafc;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }
        
        .log-time {
            color: #718096;
            font-size: 0.8rem;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px 0;
            color: #cbd5e0;
            border-top: 1px solid #4a5568;
        }
        
        .dashboard {
            display: none;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .dashboard-card i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .dashboard-card h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .webcam-container {
                width: 150px;
                height: 150px;
            }
            
            .exam-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .exam-controls button {
                width: 100%;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                Secure<span>Exam</span> Pro
            </div>
            <div class="auth-buttons">
                <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
                <button id="registerBtn"><i class="fas fa-user-plus"></i> Register</button>
            </div>
            <div class="user-info" id="userInfo">
                <div class="user-avatar" id="userAvatar">JD</div>
                <span id="userName">John Doe</span>
                <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>
    </header>

    <div class="warning-banner" id="warningBanner">
        <strong><i class="fas fa-exclamation-triangle"></i> Security Alert:</strong> <span id="warningMessage">Unusual activity detected. This incident will be reported.</span>
    </div>

    <div class="webcam-container" id="webcamContainer">
        <video class="webcam-feed" id="webcamFeed" autoplay muted></video>
        <div class="webcam-status">LIVE - AI Proctoring Active</div>
    </div>

    <div class="container">
        <div class="main-content" id="mainContent">
            <div class="sidebar">
                <h2><i class="fas fa-shield-alt"></i> Security Features</h2>
                <ul class="feature-list">
                    <li><i class="fas fa-check-circle"></i> Multi-factor Authentication</li>
                    <li><i class="fas fa-check-circle"></i> Live Webcam Proctoring</li>
                    <li><i class="fas fa-check-circle"></i> AI Behavior Analysis</li>
                    <li><i class="fas fa-check-circle"></i> Secure Browser Lock</li>
                    <li><i class="fas fa-check-circle"></i> Tab Switching Detection</li>
                    <li><i class="fas fa-check-circle"></i> Copy/Paste Prevention</li>
                    <li><i class="fas fa-check-circle"></i> Keystroke Dynamics</li>
                    <li><i class="fas fa-check-circle"></i> Time-bound Assessments</li>
                    <li><i class="fas fa-check-circle"></i> Question Randomization</li>
                    <li><i class="fas fa-check-circle"></i> Encrypted Communication</li>
                </ul>
                
                <div class="security-indicator">
                    <div class="security-status" id="securityStatus"></div>
                    <span id="securityText">All Security Systems Active</span>
                </div>
                
                <div class="security-log" id="securityLog">
                    <div class="log-entry">
                        <span>System initialized</span>
                        <span class="log-time" id="currentTime">00:00:00</span>
                    </div>
                </div>
            </div>
            
            <div class="content" id="contentArea">
                <h1><i class="fas fa-graduation-cap"></i> Available Exams</h1>
                
                <div class="exam-card">
                    <div class="exam-title">Mathematics Final Examination</div>
                    <div class="exam-details">
                        <span><i class="far fa-clock"></i> Duration: 60 minutes</span>
                        <span><i class="far fa-question-circle"></i> Questions: 30</span>
                    </div>
                    <p>This exam covers algebra, geometry, and calculus topics from the current semester. All security protocols will be enforced.</p>
                    <button class="btn start-exam" data-exam="math"><i class="fas fa-play-circle"></i> Start Exam</button>
                </div>
                
                <div class="exam-card">
                    <div class="exam-title">Science Midterm Assessment</div>
                    <div class="exam-details">
                        <span><i class="far fa-clock"></i> Duration: 45 minutes</span>
                        <span><i class="far fa-question-circle"></i> Questions: 25</span>
                    </div>
                    <p>Test your knowledge of physics, chemistry, and biology concepts. AI proctoring will monitor your session.</p>
                    <button class="btn start-exam" data-exam="science"><i class="fas fa-play-circle"></i> Start Exam</button>
                </div>
                
                <div class="exam-card">
                    <div class="exam-title">History Comprehensive Quiz</div>
                    <div class="exam-details">
                        <span><i class="far fa-clock"></i> Duration: 30 minutes</span>
                        <span><i class="far fa-question-circle"></i> Questions: 20</span>
                    </div>
                    <p>World history from ancient civilizations to modern times. Secure browser mode required.</p>
                    <button class="btn start-exam" data-exam="history"><i class="fas fa-play-circle"></i> Start Exam</button>
                </div>
            </div>
        </div>
        
        <div class="dashboard" id="dashboard">
            <h1><i class="fas fa-tachometer-alt"></i> Student Dashboard</h1>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <i class="fas fa-user-graduate"></i>
                    <h3>My Profile</h3>
                    <p>View and update your personal information</p>
                </div>
                
                <div class="dashboard-card">
                    <i class="fas fa-history"></i>
                    <h3>Exam History</h3>
                    <p>Review your past exam results and performance</p>
                </div>
                
                <div class="dashboard-card">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Upcoming Exams</h3>
                    <p>Check your scheduled exams and deadlines</p>
                </div>
                
                <div class="dashboard-card">
                    <i class="fas fa-chart-line"></i>
                    <h3>Performance Analytics</h3>
                    <p>Track your progress and identify areas for improvement</p>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h2><i class="fas fa-book-open"></i> Available Exams</h2>
                
                <div class="exam-card">
                    <div class="exam-title">Mathematics Final Examination</div>
                    <div class="exam-details">
                        <span><i class="far fa-clock"></i> Duration: 60 minutes</span>
                        <span><i class="far fa-question-circle"></i> Questions: 30</span>
                    </div>
                    <p>This exam covers algebra, geometry, and calculus topics from the current semester. All security protocols will be enforced.</p>
                    <button class="btn start-exam" data-exam="math"><i class="fas fa-play-circle"></i> Start Exam</button>
                </div>
                
                <div class="exam-card">
                    <div class="exam-title">Science Midterm Assessment</div>
                    <div class="exam-details">
                        <span><i class="far fa-clock"></i> Duration: 45 minutes</span>
                        <span><i class="far fa-question-circle"></i> Questions: 25</span>
                    </div>
                    <p>Test your knowledge of physics, chemistry, and biology concepts. AI proctoring will monitor your session.</p>
                    <button class="btn start-exam" data-exam="science"><i class="fas fa-play-circle"></i> Start Exam</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeLoginModal">&times;</span>
            <h2><i class="fas fa-sign-in-alt"></i> Login to Your Account</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn" style="width: 100%;"><i class="fas fa-lock"></i> Secure Login</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">Don't have an account? <a href="#" id="showRegister">Register</a></p>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeRegisterModal">&times;</span>
            <h2><i class="fas fa-user-plus"></i> Create New Account</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="regName">Full Name</label>
                    <input type="text" id="regName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="regEmail">Email Address</label>
                    <input type="email" id="regEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" required placeholder="Create a strong password">
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Confirm Password</label>
                    <input type="password" id="regConfirmPassword" required placeholder="Confirm your password">
                </div>
                <button type="submit" class="btn" style="width: 100%;"><i class="fas fa-user-shield"></i> Create Secure Account</button>
            </form>
            <p style="text-align: center; margin-top: 15px;">Already have an account? <a href="#" id="showLogin">Login</a></p>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeOtpModal">&times;</span>
            <h2><i class="fas fa-mobile-alt"></i> OTP Verification</h2>
            <p>We've sent a 6-digit verification code to your registered email address for enhanced security.</p>
            <div class="otp-container">
                <input type="text" class="otp-input" maxlength="1" data-index="0">
                <input type="text" class="otp-input" maxlength="1" data-index="1">
                <input type="text" class="otp-input" maxlength="1" data-index="2">
                <input type="text" class="otp-input" maxlength="1" data-index="3">
                <input type="text" class="otp-input" maxlength="1" data-index="4">
                <input type="text" class="otp-input" maxlength="1" data-index="5">
            </div>
            <p id="otpTimer" class="timer">02:00</p>
            <button id="verifyOtp" class="btn" style="width: 100%;"><i class="fas fa-check-circle"></i> Verify OTP</button>
            <p style="text-align: center; margin-top: 15px;">Didn't receive the code? <a href="#" id="resendOtp">Resend OTP</a></p>
        </div>
    </div>

    <!-- Exam Interface -->
    <div id="examModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <span class="close-modal" id="closeExamModal">&times;</span>
            <h2 id="examTitle"><i class="fas fa-pencil-alt"></i> Mathematics Final Examination</h2>
            <div class="timer" id="examTimer">60:00</div>
            
            <div class="progress-bar">
                <div class="progress" id="examProgress"></div>
            </div>
            
            <div class="question-nav" id="questionNav">
                <!-- Question navigation buttons will be generated here -->
            </div>
            
            <div class="question" id="currentQuestion">
                <h3>Question 1</h3>
                <p>What is the value of x in the equation 2x + 5 = 15?</p>
                <div class="options">
                    <div class="option" data-value="a">5</div>
                    <div class="option" data-value="b">10</div>
                    <div class="option" data-value="c">7.5</div>
                    <div class="option" data-value="d">8</div>
                </div>
            </div>
            
            <div class="exam-controls">
                <button id="prevQuestion" class="btn"><i class="fas fa-arrow-left"></i> Previous</button>
                <button id="nextQuestion" class="btn">Next <i class="fas fa-arrow-right"></i></button>
            </div>
            
            <button id="submitExam" class="btn btn-danger" style="width: 100%; margin-top: 20px;"><i class="fas fa-paper-plane"></i> Submit Exam</button>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeResultsModal">&times;</span>
            <h2><i class="fas fa-chart-line"></i> Exam Results</h2>
            <div id="resultsContent">
                <!-- Results will be displayed here -->
            </div>
            <button id="closeResults" class="btn" style="width: 100%; margin-top: 20px;"><i class="fas fa-times"></i> Close</button>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>SecureExam Pro &copy; 2023. All rights reserved.</p>
            <p>Advanced Online Examination System with AI Proctoring and Multi-layer Security</p>
        </div>
    </footer>

    <script>
        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const userInfo = document.getElementById('userInfo');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const otpModal = document.getElementById('otpModal');
        const examModal = document.getElementById('examModal');
        const resultsModal = document.getElementById('resultsModal');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const startExamBtns = document.querySelectorAll('.start-exam');
        const verifyOtpBtn = document.getElementById('verifyOtp');
        const resendOtpBtn = document.getElementById('resendOtp');
        const submitExamBtn = document.getElementById('submitExam');
        const prevQuestionBtn = document.getElementById('prevQuestion');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const closeResultsBtn = document.getElementById('closeResults');
        const otpInputs = document.querySelectorAll('.otp-input');
        const examTimer = document.getElementById('examTimer');
        const otpTimer = document.getElementById('otpTimer');
        const examProgress = document.getElementById('examProgress');
        const questionNav = document.getElementById('questionNav');
        const currentQuestion = document.getElementById('currentQuestion');
        const warningBanner = document.getElementById('warningBanner');
        const warningMessage = document.getElementById('warningMessage');
        const webcamContainer = document.getElementById('webcamContainer');
        const webcamFeed = document.getElementById('webcamFeed');
        const securityStatus = document.getElementById('securityStatus');
        const securityText = document.getElementById('securityText');
        const securityLog = document.getElementById('securityLog');
        const currentTime = document.getElementById('currentTime');
        const mainContent = document.getElementById('mainContent');
        const dashboard = document.getElementById('dashboard');
        const contentArea = document.getElementById('contentArea');
        
        // Close modal buttons
        const closeLoginModal = document.getElementById('closeLoginModal');
        const closeRegisterModal = document.getElementById('closeRegisterModal');
        const closeOtpModal = document.getElementById('closeOtpModal');
        const closeExamModal = document.getElementById('closeExamModal');
        const closeResultsModal = document.getElementById('closeResultsModal');
        
        // Application State
        let currentUser = null;
        let examInProgress = false;
        let currentExam = null;
        let examQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let otpCode = '';
        let otpInterval;
        let examInterval;
        let warningCount = 0;
        let webcamStream = null;
        let securityLogEntries = [];
        let keystrokeTiming = [];
        let lastKeystrokeTime = Date.now();
        let headMovementCount = 0;
        let headMovementInterval;
        let faceDetectionInterval;
        
        // Event Listeners
        loginBtn.addEventListener('click', () => showModal(loginModal));
        registerBtn.addEventListener('click', () => showModal(registerModal));
        logoutBtn.addEventListener('click', logout);
        showRegister.addEventListener('click', (e) => {
            e.preventDefault();
            hideModal(loginModal);
            showModal(registerModal);
        });
        showLogin.addEventListener('click', (e) => {
            e.preventDefault();
            hideModal(registerModal);
            showModal(loginModal);
        });
        
        // Close modal events
        closeLoginModal.addEventListener('click', () => hideModal(loginModal));
        closeRegisterModal.addEventListener('click', () => hideModal(registerModal));
        closeOtpModal.addEventListener('click', () => hideModal(otpModal));
        closeExamModal.addEventListener('click', () => {
            if(examInProgress) {
                if(confirm('Are you sure you want to exit the exam? Your progress will be lost and this may be reported as suspicious activity.')) {
                    endExam();
                    hideModal(examModal);
                }
            } else {
                hideModal(examModal);
            }
        });
        closeResultsModal.addEventListener('click', () => hideModal(resultsModal));
        closeResultsBtn.addEventListener('click', () => hideModal(resultsModal));
        
        startExamBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if(!currentUser) {
                    alert('Please login first to take an exam.');
                    showModal(loginModal);
                    return;
                }
                
                currentExam = btn.getAttribute('data-exam');
                showModal(otpModal);
                generateOtp();
                startOtpTimer(120); // 2 minutes
            });
        });
        
        verifyOtpBtn.addEventListener('click', verifyOtp);
        
        resendOtpBtn.addEventListener('click', (e) => {
            e.preventDefault();
            generateOtp();
            startOtpTimer(120); // Reset timer
            alert('New OTP sent to your email!');
        });
        
        submitExamBtn.addEventListener('click', submitExam);
        
        prevQuestionBtn.addEventListener('click', () => navigateQuestion(-1));
        nextQuestionBtn.addEventListener('click', () => navigateQuestion(1));
        
        // OTP Input handling
        otpInputs.forEach(input => {
            input.addEventListener('input', (e) => {
                // Move to next input if current one is filled
                if(e.target.value.length === 1) {
                    const nextIndex = parseInt(e.target.dataset.index) + 1;
                    if(nextIndex < otpInputs.length) {
                        otpInputs[nextIndex].focus();
                    }
                }
            });
            
            input.addEventListener('keydown', (e) => {
                // Move to previous input on backspace if current is empty
                if(e.key === 'Backspace' && e.target.value === '') {
                    const prevIndex = parseInt(e.target.dataset.index) - 1;
                    if(prevIndex >= 0) {
                        otpInputs[prevIndex].focus();
                    }
                }
            });
        });
        
        // Form submission handlers
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            login();
        });
        
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            register();
        });
        
        // Security monitoring
        document.addEventListener('visibilitychange', handleVisibilityChange);
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('keydown', handleKeyEvents);
        document.addEventListener('keyup', trackKeystrokeTiming);
        document.addEventListener('mousemove', trackMouseMovement);
        document.addEventListener('contextmenu', handleContextMenu);
        document.addEventListener('blur', handleWindowBlur);
        document.addEventListener('copy', handleCopy);
        document.addEventListener('cut', handleCut);
        document.addEventListener('paste', handlePaste);
        
        // Initialize the application
        init();
        
        // Functions
        function init() {
            // Update current time
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Check if user is already logged in (from localStorage)
            const savedUser = localStorage.getItem('currentUser');
            if(savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUIForUser();
                showDashboard();
            }
            
            // Initialize questions for demo
            initExamQuestions();
            
            // Add initial security log entry
            addSecurityLog('System initialized and security protocols activated');
        }
        
        function updateCurrentTime() {
            const now = new Date();
            currentTime.textContent = now.toLocaleTimeString();
        }
        
        function initExamQuestions() {
            // Demo questions for each exam
            const mathQuestions = [
                {
                    id: 1,
                    text: "What is the value of x in the equation 2x + 5 = 15?",
                    options: ["5", "10", "7.5", "8"],
                    correct: 0
                },
                {
                    id: 2,
                    text: "Which of the following is a prime number?",
                    options: ["15", "21", "29", "33"],
                    correct: 2
                },
                {
                    id: 3,
                    text: "What is the area of a circle with radius 5?",
                    options: ["10π", "25π", "50π", "100π"],
                    correct: 1
                },
                {
                    id: 4,
                    text: "Solve for y: 3y - 7 = 8",
                    options: ["y = 3", "y = 5", "y = 6", "y = 7"],
                    correct: 1
                },
                {
                    id: 5,
                    text: "What is the derivative of x²?",
                    options: ["x", "2x", "2", "x²"],
                    correct: 1
                },
                {
                    id: 6,
                    text: "What is 15% of 200?",
                    options: ["15", "30", "25", "20"],
                    correct: 1
                },
                {
                    id: 7,
                    text: "If a triangle has angles 45° and 55°, what is the third angle?",
                    options: ["80°", "90°", "100°", "70°"],
                    correct: 0
                },
                {
                    id: 8,
                    text: "What is the square root of 144?",
                    options: ["11", "12", "13", "14"],
                    correct: 1
                },
                {
                    id: 9,
                    text: "Simplify: 3(x + 4) - 2x",
                    options: ["x + 12", "3x + 12", "x + 4", "5x + 12"],
                    correct: 0
                },
                {
                    id: 10,
                    text: "What is the value of 5! (5 factorial)?",
                    options: ["100", "120", "60", "25"],
                    correct: 1
                }
            ];
            
            const scienceQuestions = [
                {
                    id: 1,
                    text: "What is the chemical symbol for gold?",
                    options: ["Go", "Gd", "Au", "Ag"],
                    correct: 2
                },
                {
                    id: 2,
                    text: "Which planet is known as the Red Planet?",
                    options: ["Venus", "Mars", "Jupiter", "Saturn"],
                    correct: 1
                },
                {
                    id: 3,
                    text: "What is the hardest natural substance on Earth?",
                    options: ["Gold", "Iron", "Diamond", "Platinum"],
                    correct: 2
                },
                {
                    id: 4,
                    text: "What is the main gas found in the Earth's atmosphere?",
                    options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"],
                    correct: 2
                },
                {
                    id: 5,
                    text: "How many bones are in the human body?",
                    options: ["206", "300", "150", "250"],
                    correct: 0
                },
                {
                    id: 6,
                    text: "What is the chemical formula for water?",
                    options: ["H2O", "CO2", "NaCl", "O2"],
                    correct: 0
                },
                {
                    id: 7,
                    text: "Which organ pumps blood throughout the body?",
                    options: ["Liver", "Heart", "Lungs", "Brain"],
                    correct: 1
                },
                {
                    id: 8,
                    text: "What is the speed of light?",
                    options: ["300,000 km/s", "150,000 km/s", "500,000 km/s", "1,000,000 km/s"],
                    correct: 0
                },
                {
                    id: 9,
                    text: "What is the atomic number of carbon?",
                    options: ["6", "12", "8", "14"],
                    correct: 0
                },
                {
                    id: 10,
                    text: "Which gas do plants absorb from the atmosphere?",
                    options: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"],
                    correct: 2
                }
            ];
            
            const historyQuestions = [
                {
                    id: 1,
                    text: "In which year did World War II end?",
                    options: ["1943", "1945", "1947", "1950"],
                    correct: 1
                },
                {
                    id: 2,
                    text: "Who was the first President of the United States?",
                    options: ["Thomas Jefferson", "John Adams", "George Washington", "James Madison"],
                    correct: 2
                },
                {
                    id: 3,
                    text: "Which ancient civilization built the Machu Picchu?",
                    options: ["Aztec", "Maya", "Inca", "Olmec"],
                    correct: 2
                },
                {
                    id: 4,
                    text: "When did the French Revolution begin?",
                    options: ["1776", "1789", "1799", "1804"],
                    correct: 1
                },
                {
                    id: 5,
                    text: "Who discovered America?",
                    options: ["Vasco da Gama", "Christopher Columbus", "Ferdinand Magellan", "James Cook"],
                    correct: 1
                },
                {
                    id: 6,
                    text: "Which empire was ruled by Julius Caesar?",
                    options: ["Greek", "Roman", "Egyptian", "Persian"],
                    correct: 1
                },
                {
                    id: 7,
                    text: "When was the Declaration of Independence signed?",
                    options: ["1776", "1789", "1799", "1801"],
                    correct: 0
                },
                {
                    id: 8,
                    text: "Who was the first woman to win a Nobel Prize?",
                    options: ["Marie Curie", "Rosalind Franklin", "Jane Goodall", "Florence Nightingale"],
                    correct: 0
                },
                {
                    id: 9,
                    text: "Which war was fought between the North and South in the United States?",
                    options: ["Revolutionary War", "Civil War", "World War I", "World War II"],
                    correct: 1
                },
                {
                    id: 10,
                    text: "Who wrote the 'I Have a Dream' speech?",
                    options: ["Malcolm X", "Martin Luther King Jr.", "Rosa Parks", "Barack Obama"],
                    correct: 1
                }
            ];
            
            // Store questions for each exam type
            window.examQuestions = {
                math: mathQuestions,
                science: scienceQuestions,
                history: historyQuestions
            };
        }
        
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple validation
            if(!email || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            // In a real app, this would be an API call
            // For demo, we'll simulate a successful login
            currentUser = {
                name: email.split('@')[0],
                email: email,
                avatar: email.substring(0, 2).toUpperCase()
            };
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            updateUIForUser();
            hideModal(loginModal);
            showDashboard();
            addSecurityLog(`User ${email} logged in successfully`);
            alert('Login successful!');
        }
        
        function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            // Simple validation
            if(!name || !email || !password || !confirmPassword) {
                alert('Please fill in all fields');
                return;
            }
            
            if(password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            // In a real app, this would be an API call
            // For demo, we'll simulate a successful registration
            currentUser = {
                name: name,
                email: email,
                avatar: name.substring(0, 2).toUpperCase()
            };
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            updateUIForUser();
            hideModal(registerModal);
            showDashboard();
            addSecurityLog(`New user registered: ${name} (${email})`);
            alert('Registration successful!');
        }
        
        function logout() {
            addSecurityLog(`User ${currentUser.email} logged out`);
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUIForUser();
            hideDashboard();
            alert('You have been logged out.');
        }
        
        function updateUIForUser() {
            if(currentUser) {
                loginBtn.style.display = 'none';
                registerBtn.style.display = 'none';
                userInfo.style.display = 'flex';
                userAvatar.textContent = currentUser.avatar;
                userName.textContent = currentUser.name;
            } else {
                loginBtn.style.display = 'inline-block';
                registerBtn.style.display = 'inline-block';
                userInfo.style.display = 'none';
            }
        }
        
        function showDashboard() {
            mainContent.style.display = 'none';
            dashboard.style.display = 'block';
        }
        
        function hideDashboard() {
            dashboard.style.display = 'none';
            mainContent.style.display = 'flex';
        }
        
        function generateOtp() {
            // Generate a random 6-digit OTP
            otpCode = Math.floor(100000 + Math.random() * 900000).toString();
            
            // In a real app, this would be sent to the user's email
            console.log(`OTP for ${currentUser.email}: ${otpCode}`);
            
            // For demo purposes, we'll show it in an alert
            alert(`Demo OTP: ${otpCode} (In a real app, this would be sent to your email)`);
            
            // Clear OTP inputs
            otpInputs.forEach(input => input.value = '');
            otpInputs[0].focus();
            
            addSecurityLog(`OTP generated for user ${currentUser.email}`);
        }
        
        function verifyOtp() {
            let enteredOtp = '';
            otpInputs.forEach(input => {
                enteredOtp += input.value;
            });
            
            if(enteredOtp === otpCode) {
                clearInterval(otpInterval);
                hideModal(otpModal);
                addSecurityLog(`OTP verification successful for user ${currentUser.email}`);
                startExam();
            } else {
                alert('Invalid OTP. Please try again.');
                // Clear OTP inputs
                otpInputs.forEach(input => input.value = '');
                otpInputs[0].focus();
                addSecurityLog(`Failed OTP attempt for user ${currentUser.email}`);
            }
        }
        
        function startExam() {
            examInProgress = true;
            currentQuestionIndex = 0;
            userAnswers = new Array(window.examQuestions[currentExam].length).fill(null);
            keystrokeTiming = [];
            lastKeystrokeTime = Date.now();
            headMovementCount = 0;
            
            // Initialize webcam
            startWebcam();
            
            // Initialize security monitoring
            startSecurityMonitoring();
            
            // Set up exam questions
            setupExamQuestions();
            
            // Start exam timer
            startExamTimer(60 * 60); // 60 minutes
            
            showModal(examModal);
            addSecurityLog(`Exam started: ${currentExam} for user ${currentUser.email}`);
        }
        
        function setupExamQuestions() {
            examQuestions = window.examQuestions[currentExam];
            
            // Set exam title
            document.getElementById('examTitle').textContent = 
                currentExam === 'math' ? 'Mathematics Final Examination' :
                currentExam === 'science' ? 'Science Midterm Assessment' : 'History Comprehensive Quiz';
            
            // Generate question navigation
            questionNav.innerHTML = '';
            examQuestions.forEach((_, index) => {
                const btn = document.createElement('div');
                btn.className = 'question-nav-btn';
                btn.textContent = index + 1;
                btn.addEventListener('click', () => goToQuestion(index));
                questionNav.appendChild(btn);
            });
            
            // Show first question
            showQuestion(0);
        }
        
        function showQuestion(index) {
            if(index < 0 || index >= examQuestions.length) return;
            
            currentQuestionIndex = index;
            const question = examQuestions[index];
            
            // Update question navigation
            const navButtons = questionNav.querySelectorAll('.question-nav-btn');
            navButtons.forEach((btn, i) => {
                btn.classList.remove('current');
                if(i === index) btn.classList.add('current');
                if(userAnswers[i] !== null) btn.classList.add('answered');
            });
            
            // Update question content
            currentQuestion.innerHTML = `
                <h3>Question ${index + 1}</h3>
                <p>${question.text}</p>
                <div class="options">
                    ${question.options.map((option, i) => 
                        `<div class="option ${userAnswers[index] === i ? 'selected' : ''}" data-value="${i}">${option}</div>`
                    ).join('')}
                </div>
            `;
            
            // Add event listeners to options
            currentQuestion.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from siblings
                    option.parentElement.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Save answer
                    userAnswers[index] = parseInt(option.getAttribute('data-value'));
                    
                    // Update navigation
                    navButtons[index].classList.add('answered');
                    
                    // Update progress
                    updateProgress();
                    
                    // Log activity
                    addSecurityLog(`Question ${index + 1} answered`);
                });
            });
            
            // Update navigation buttons
            prevQuestionBtn.disabled = index === 0;
            nextQuestionBtn.disabled = index === examQuestions.length - 1;
        }
        
        function navigateQuestion(direction) {
            const newIndex = currentQuestionIndex + direction;
            if(newIndex >= 0 && newIndex < examQuestions.length) {
                showQuestion(newIndex);
                addSecurityLog(`Navigated to question ${newIndex + 1}`);
            }
        }
        
        function goToQuestion(index) {
            showQuestion(index);
            addSecurityLog(`Jumped to question ${index + 1}`);
        }
        
        function updateProgress() {
            const answered = userAnswers.filter(answer => answer !== null).length;
            const progress = (answered / examQuestions.length) * 100;
            examProgress.style.width = `${progress}%`;
        }
        
        function submitExam() {
            if(confirm('Are you sure you want to submit your exam? This action cannot be undone.')) {
                endExam();
                calculateResults();
            }
        }
        
        function autoSubmitExam() {
            alert('Exam has been automatically submitted due to suspicious activity.');
            endExam();
            calculateResults();
        }
        
        function endExam() {
            examInProgress = false;
            clearInterval(examInterval);
            clearInterval(headMovementInterval);
            clearInterval(faceDetectionInterval);
            stopWebcam();
            stopSecurityMonitoring();
            hideModal(examModal);
            addSecurityLog(`Exam completed for user ${currentUser.email}`);
        }
        
        function calculateResults() {
            let correct = 0;
            examQuestions.forEach((question, index) => {
                if(userAnswers[index] === question.correct) {
                    correct++;
                }
            });
            
            const percentage = (correct / examQuestions.length) * 100;
            const grade = percentage >= 90 ? 'A' : 
                         percentage >= 80 ? 'B' : 
                         percentage >= 70 ? 'C' : 
                         percentage >= 60 ? 'D' : 'F';
            
            // Analyze keystroke dynamics for suspicious patterns
            const keystrokeAnalysis = analyzeKeystrokePatterns();
            
            document.getElementById('resultsContent').innerHTML = `
                <h3>Exam: ${document.getElementById('examTitle').textContent}</h3>
                <p>Total Questions: ${examQuestions.length}</p>
                <p>Correct Answers: ${correct}</p>
                <p>Score: ${percentage.toFixed(2)}%</p>
                <p>Grade: ${grade}</p>
                <p>Security Warnings: ${warningCount}</p>
                <p>Keystroke Analysis: ${keystrokeAnalysis}</p>
                <p>Head Movement Detections: ${headMovementCount}</p>
                <p>Completion Time: ${formatTime(60 * 60 - getRemainingExamTime())}</p>
            `;
            
            showModal(resultsModal);
            addSecurityLog(`Exam results: ${correct}/${examQuestions.length} correct (${percentage.toFixed(2)}%)`);
        }
        
        function startWebcam() {
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        webcamStream = stream;
                        webcamFeed.srcObject = stream;
                        webcamContainer.style.display = 'block';
                        addSecurityLog('Webcam activated for proctoring');
                        
                        // Simulate head movement detection
                        simulateHeadMovementDetection();
                        
                        // Simulate face detection
                        simulateFaceDetection();
                    })
                    .catch(err => {
                        console.error('Error accessing webcam:', err);
                        addSecurityLog('Webcam access denied - limited proctoring available');
                        alert('Could not access webcam. Exam may not be monitored properly.');
                    });
            } else {
                addSecurityLog('Webcam not supported in this browser');
                alert('Webcam not supported in this browser. Exam may not be monitored properly.');
            }
        }
        
        function stopWebcam() {
            if(webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
                webcamStream = null;
                webcamContainer.style.display = 'none';
                addSecurityLog('Webcam deactivated');
            }
        }
        
        function simulateHeadMovementDetection() {
            // In a real app, this would use AI/ML to detect head movements
            // For demo, we'll simulate random head movement detection
            headMovementInterval = setInterval(() => {
                if (examInProgress && Math.random() < 0.1) { // 10% chance per interval
                    headMovementCount++;
                    addSecurityLog(`Head movement detected (${headMovementCount})`);
                    
                    // Auto-submit if too many head movements detected
                    if (headMovementCount >= 5) {
                        addSecurityLog('Excessive head movement detected - auto-submitting exam');
                        autoSubmitExam();
                    }
                }
            }, 10000); // Check every 10 seconds
        }
        
        function simulateFaceDetection() {
            // In a real app, this would use face detection API
            // For demo, we'll simulate face detection
            faceDetectionInterval = setInterval(() => {
                if (examInProgress && Math.random() < 0.05) { // 5% chance per interval
                    addSecurityLog('Multiple faces detected in frame');
                    warningCount++;
                    showWarning('Multiple faces detected! This incident has been recorded.');
                    
                    // Auto-submit if multiple faces detected
                    if (warningCount >= 2) {
                        addSecurityLog('Multiple faces detected repeatedly - auto-submitting exam');
                        autoSubmitExam();
                    }
                }
                
                if (examInProgress && Math.random() < 0.03) { // 3% chance per interval
                    addSecurityLog('No face detected in frame');
                    warningCount++;
                    showWarning('No face detected! Looking away from screen is prohibited.');
                    
                    // Auto-submit if no face detected multiple times
                    if (warningCount >= 3) {
                        addSecurityLog('Repeated no face detection - auto-submitting exam');
                        autoSubmitExam();
                    }
                }
            }, 15000); // Check every 15 seconds
        }
        
        function startSecurityMonitoring() {
            // Reset warning count
            warningCount = 0;
            warningBanner.style.display = 'none';
            
            // Set security status to active
            securityStatus.style.backgroundColor = 'var(--success-color)';
            securityText.textContent = 'All Security Systems Active';
            
            addSecurityLog('Enhanced security monitoring activated');
        }
        
        function stopSecurityMonitoring() {
            securityStatus.style.backgroundColor = '#ccc';
            securityText.textContent = 'Security Systems Inactive';
            
            addSecurityLog('Security monitoring deactivated');
        }
        
        function handleVisibilityChange() {
            if(examInProgress && document.hidden) {
                warningCount++;
                showWarning('Tab switching detected! This incident has been recorded.');
                addSecurityLog('Tab switching detected - potential cheating attempt');
                
                // Auto-submit on tab switch
                if (warningCount >= 2) {
                    addSecurityLog('Multiple tab switches detected - auto-submitting exam');
                    autoSubmitExam();
                }
            }
        }
        
        function handleFullscreenChange() {
            if(examInProgress && !document.fullscreenElement) {
                warningCount++;
                showWarning('Fullscreen exit detected! This incident has been recorded.');
                addSecurityLog('Fullscreen exit detected - potential cheating attempt');
            }
        }
        
        function handleKeyEvents(e) {
            if(examInProgress) {
                // Prevent keyboard shortcuts
                if((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'v' || e.key === 'x' || e.key === 'a')) {
                    e.preventDefault();
                    warningCount++;
                    showWarning('Copy/paste detected! This incident has been recorded.');
                    addSecurityLog('Copy/paste attempt detected - potential cheating');
                    
                    // Auto-submit on copy/paste attempt
                    autoSubmitExam();
                }
                
                // Prevent F12, Ctrl+Shift+I, etc.
                if(e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || (e.ctrlKey && e.shiftKey && e.key === 'J') || (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                    warningCount++;
                    showWarning('Developer tools access detected! This incident has been recorded.');
                    addSecurityLog('Developer tools access attempt detected');
                    
                    // Auto-submit on dev tools access
                    autoSubmitExam();
                }
                
                // Detect print screen
                if(e.key === 'PrintScreen') {
                    e.preventDefault();
                    warningCount++;
                    showWarning('Screenshot attempt detected! This incident has been recorded.');
                    addSecurityLog('Screenshot attempt detected');
                    
                    // Auto-submit on screenshot attempt
                    autoSubmitExam();
                }
            }
        }
        
        function handleCopy(e) {
            if(examInProgress) {
                e.preventDefault();
                warningCount++;
                showWarning('Copying text is prohibited during exams!');
                addSecurityLog('Copy attempt blocked');
                
                // Auto-submit on copy
                autoSubmitExam();
            }
        }
        
        function handleCut(e) {
            if(examInProgress) {
                e.preventDefault();
                warningCount++;
                showWarning('Cutting text is prohibited during exams!');
                addSecurityLog('Cut attempt blocked');
                
                // Auto-submit on cut
                autoSubmitExam();
            }
        }
        
        function handlePaste(e) {
            if(examInProgress) {
                e.preventDefault();
                warningCount++;
                showWarning('Pasting text is prohibited during exams!');
                addSecurityLog('Paste attempt blocked');
                
                // Auto-submit on paste
                autoSubmitExam();
            }
        }
        
        function handleContextMenu(e) {
            if(examInProgress) {
                e.preventDefault();
                warningCount++;
                showWarning('Right-click disabled during exam!');
                addSecurityLog('Right-click attempt blocked');
                
                // Auto-submit on right-click
                autoSubmitExam();
            }
        }
        
        function handleWindowBlur() {
            if(examInProgress) {
                warningCount++;
                showWarning('Window focus lost! This incident has been recorded.');
                addSecurityLog('Window focus lost - potential cheating attempt');
                
                // Auto-submit on window blur
                if (warningCount >= 2) {
                    addSecurityLog('Multiple window focus losses detected - auto-submitting exam');
                    autoSubmitExam();
                }
            }
        }
        
        function trackKeystrokeTiming() {
            if(examInProgress) {
                const now = Date.now();
                const timeSinceLastKey = now - lastKeystrokeTime;
                keystrokeTiming.push(timeSinceLastKey);
                lastKeystrokeTime = now;
                
                // Keep only the last 100 keystrokes
                if(keystrokeTiming.length > 100) {
                    keystrokeTiming.shift();
                }
            }
        }
        
        function trackMouseMovement(e) {
            if(examInProgress) {
                // In a real system, we would analyze mouse movements for suspicious patterns
                // This is a simplified version
                if(e.movementX > 100 || e.movementY > 100) {
                    // Rapid mouse movement could indicate switching between windows
                    addSecurityLog('Unusual mouse movement pattern detected');
                }
            }
        }
        
        function analyzeKeystrokePatterns() {
            if(keystrokeTiming.length < 10) return "Insufficient data";
            
            const avgTime = keystrokeTiming.reduce((a, b) => a + b, 0) / keystrokeTiming.length;
            const variance = keystrokeTiming.reduce((a, b) => a + Math.pow(b - avgTime, 2), 0) / keystrokeTiming.length;
            
            // Very consistent timing could indicate automated input
            if(variance < 10) {
                addSecurityLog('Suspicious keystroke pattern detected - possible automation');
                return "Suspicious - possible automated input";
            }
            
            // Very inconsistent timing could indicate multiple people
            if(variance > 1000) {
                addSecurityLog('Irregular keystroke pattern detected - possible multiple users');
                return "Irregular - possible multiple users";
            }
            
            return "Normal typing pattern";
        }
        
        function showWarning(message) {
            warningMessage.textContent = message;
            warningBanner.style.display = 'block';
            
            // Flash security status
            securityStatus.style.backgroundColor = 'var(--warning-color)';
            securityText.textContent = 'Security Alert!';
            
            setTimeout(() => {
                if(warningCount === 0) {
                    securityStatus.style.backgroundColor = 'var(--success-color)';
                    securityText.textContent = 'All Security Systems Active';
                }
            }, 3000);
        }
        
        function addSecurityLog(message) {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span>${message}</span>
                <span class="log-time">${timeString}</span>
            `;
            
            securityLog.insertBefore(logEntry, securityLog.firstChild);
            
            // Keep only the last 10 log entries
            if(securityLog.children.length > 10) {
                securityLog.removeChild(securityLog.lastChild);
            }
            
            // Also add to internal array for potential reporting
            securityLogEntries.push({
                message: message,
                timestamp: now
            });
        }
        
        function startOtpTimer(duration) {
            let timer = duration;
            clearInterval(otpInterval);
            
            otpInterval = setInterval(() => {
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                
                otpTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (--timer < 0) {
                    clearInterval(otpInterval);
                    otpTimer.textContent = "Time's up!";
                    otpTimer.style.color = 'var(--accent-color)';
                    alert('OTP has expired. Please request a new one.');
                    addSecurityLog('OTP expired');
                }
            }, 1000);
        }
        
        function startExamTimer(duration) {
            let timer = duration;
            clearInterval(examInterval);
            
            examInterval = setInterval(() => {
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                
                examTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (--timer < 0) {
                    clearInterval(examInterval);
                    examTimer.textContent = "Time's up!";
                    examTimer.style.color = 'var(--accent-color)';
                    alert('Time is up! Your exam will be submitted automatically.');
                    endExam();
                    calculateResults();
                }
            }, 1000);
        }
        
        function getRemainingExamTime() {
            const timeString = examTimer.textContent;
            const [minutes, seconds] = timeString.split(':').map(Number);
            return minutes * 60 + seconds;
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Modal Functions
        function showModal(modal) {
            modal.style.display = 'flex';
        }
        
        function hideModal(modal) {
            modal.style.display = 'none';
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === loginModal) hideModal(loginModal);
            if (e.target === registerModal) hideModal(registerModal);
            if (e.target === otpModal) hideModal(otpModal);
            if (e.target === examModal) {
                if(examInProgress) {
                    if(confirm('Are you sure you want to exit the exam? Your progress will be lost and this may be reported as suspicious activity.')) {
                        endExam();
                        hideModal(examModal);
                    }
                } else {
                    hideModal(examModal);
                }
            }
            if (e.target === resultsModal) hideModal(resultsModal);
        });
    </script>
</body>
</html>
